<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="viewport"
	content="width=device-width, minimum-scale=1.0, maximum-scale=1.0,user-scalable=no" />
<meta name="generator" content="bd-mobcard">
<meta http-equiv="Cache-Control" content="no-cache" />

<title>五一活动抽iphone6</title>
<link href="../resources/sui-mobile/dist/css/sm.css" rel="stylesheet" type="text/css" />
<link href="./css/style_choujiang.css" rel="stylesheet" type="text/css" />
<script src="../resources/js/zepto/zepto.js" type="text/javascript"></script>
<style type="text/css">
body{
}
</style>
</head>

<body>
	<div class=" " id="wrap">
		<div class="topbox">
			<img src="./images/top.jpg" />
		</div>




		<div class="cj_box" id="lottery">
			<ul>
				<li class="lottery-unit  lottery-unit-0 active"><img
					src="./images/p1.jpg" alt="" width="80px" height="131px" /></li>
				<li class="lottery-unit lottery-unit-1 active"><img
					src="./images/p2.jpg" alt="" width="105px" height="80px" /></li>
				<li class="lottery-unit lottery-unit-2 active"><img
					src="./images/p3.jpg" alt="" width="105px" height="80px" /></li>
				<li class="pt5"><img src="./images/cj.jpg" alt="" width="130px"
					height="46px" class="btn" /></li>
				<li class="lottery-unit pt5 fr lottery-unit-3  active"><img
					src="./images/p4.jpg" alt="" width="80px" height="131px" /></li>
				<li class="lottery-unit pt5 fr lottery-unit-4 active"><img
					src="./images/p5.jpg" alt="" width="105px" height="80px" /></li>
				<li class="lottery-unit pt5 fr lottery-unit-5 active"><img
					src="./images/p6.jpg" alt="" width="105px" height="80px" /></li>
			</ul>

		</div>
		<div class="guize">
			<p class="gztt">活动规则</p><br /> 1. 每次下单成功即可获得一次抽奖机会<br /> 2. 活动时间：4月28日—5月03日<br /> 3. 此次活动最终解释权归零元汇所有<br />
		</div>

	</div>
	<div style="display: none" id='huojiang'>
		<div class="huojiang">
			<img id='jiangping' src="./images/1.png" />
		</div>
		<div class="fenxianganniu">
			<a id='share'>领取奖品</a>
		</div>
	</div>
	<div id="jieguo" style="display: none;">
	    <div class="fenxiang"><img src="./images/fenxiang.png"></div>
	    <div style="width: auto;height: auto;text-align: center;padding-top: 20px;">
	    	<a style="padding: 10px 20px 10px 20px;background: #ffe613;color: #603d0f;border-radius: 4px;font-size: 16px;" href="https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx80bec67da02b4517&redirect_uri=http%3A%2F%2Fwww.lyhui.cn%2FWeChat%2FforwardAction%2FforwardRequest%3Fpath%3Dorders%2Forder.jsp&response_type=code&scope=snsapi_base&state=1#wechat_redirect">返回我的订单</a>
	    </div>
    </div>
	<script src="../resources/sui-mobile/dist/js/sm.js" type="text/javascript"></script>
	<script type="text/javascript">
		var lottery = {
			index : -1, //当前转动到哪个位置，起点位置
			count : 0, //总共有多少个位置
			timer : 0, //setTimeout的ID，用clearTimeout清除
			speed : 20, //初始转动速度
			times : 0, //转动次数
			cycle : 36, //转动基本次数：即至少需要转动多少次再进入抽奖环节
			prize : -1, //中奖位置
			init : function(id) {
				if ($("#" + id).find(".lottery-unit").length > 0) {
					$lottery = $("#" + id);
					$units = $lottery.find(".lottery-unit");
					this.obj = $lottery;
					this.count = $units.length;
					$lottery.find(".lottery-unit-" + this.index).addClass(
							"active");
				}
				;
			},
			roll : function() {
				var index = this.index;
				var count = this.count;
				var lottery = this.obj;
				$(lottery).find(".lottery-unit-" + index).removeClass("active");
				index += 1;
				if (index > count - 1) {
					index = 0;
				}
				;
				$(lottery).find(".lottery-unit-" + index).addClass("active");
				this.index = index;
				return false;
			},
			stop : function(index) {
				this.prize = index;
				return false;
			}
		};
		function save() {
			prize = lottery.prize;
			// ajax 保存奖品
			//$.post('/index.php/show/save_prize',{prize:prize,phone:phone},function(data){
			//});
			
			var products = [{
				id : 1,
				name : '马克杯'
			},
			{
				id : 2,
				name : '眼镜'
			},
			{
				id : 4,
				name : '风扇'
			}]
			
			var productname = '';
			
			$.each(products,function(){
				if(prize == this.id){
					productname = this.name;
				}
			});
			/*$.ajax({
					url : '../rollAction/rollProduct',
					data : {
						resProductname : productname
					},
					dataType : 'json',
					success : function(res){
				}
			});*/
			
			$('#wrap').addClass('on');
			$('.guize').css('display', 'none');
			$('#jiangping').attr('src', './images/' + lottery.prize + '.png');
			$('#huojiang').css('display', 'block');
			lottery.prize = -1;
			lottery.times = 0;
		}
		function roll() {
			lottery.times += 1;
			lottery.roll();
			if (lottery.times > lottery.cycle + 10 && lottery.prize == lottery.index) {
				clearTimeout(lottery.timer);
				click = false;
				//               alert('恭喜你获得'+lottery.prize+'等奖');
				//                $('.topbox,.guize,.cj_box').css('display','none');
				setTimeout(save, 1000);

			} else {
				if (lottery.times < lottery.cycle) {
					lottery.speed -= 40;
				} else if (lottery.times >= lottery.cycle) {
					var index = Math.random() * (lottery.count) | 0;
					if (index == 5) {
						lottery.prize = index + 3;
					} else if (index == 3) {
						//如果 抽奖结果 等于 3 和 0 继续roll
						lottery.prize = index + 1;
					} else if (index == 0) {
						lottery.prize = index + 1;
					}  else {
						lottery.prize = index;
					}

				} else {
					if (lottery.times > lottery.cycle + 10
							&& ((lottery.prize == 0 && lottery.index == 7) || lottery.prize == lottery.index + 1)) {
						lottery.speed += 80;
					} else {
						lottery.speed += 20;
					}
				}
				if (lottery.speed < 100) {
					lottery.speed = 100;
				}
				;
				//console.log(lottery.times+'^^^^^^'+lottery.speed+'^^^^^^^'+lottery.prize);
				lottery.timer = setTimeout(roll, lottery.speed);
			}
			return false;
		}

		var click = false;
		
		$(function() {
			lottery.init('lottery');
			$("#lottery .btn").click(function() {
				$.ajax({
					url : '../rollAction/getRollNumber',
					data : {},
					dataType : 'json',
					success : function(res){
						/*if(res.status){
							$.alert(res.message, function () {
					            window.location.href = 'https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx80bec67da02b4517&redirect_uri=http%3A%2F%2Fwww.lyhui.cn%2FWeChat%2FforwardAction%2FforwardRequest%3Fpath%3Dorders%2Forder.jsp&response_type=code&scope=snsapi_base&state=1#wechat_redirect';
					        });
						}else*/
						{
							$('.lottery-unit').removeClass('active');
							$('.regbox').css('display', 'none');
							$('.cj_box').css('display', 'block');

							if (click) {
								return false;
							} else {
								lottery.speed = 200;
								roll();
								click = true;
								return false;
							}
						}
					}
				});
			});
			$("#share").click(function() {
				  $('#huojiang').css('display','none');
		          $('#jieguo').css('display','block');
		          window.scroll(0, 0);
			});
		})
	</script>
</body>
</html>
